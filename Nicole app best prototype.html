<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, viewport-fit=cover">
    <title>STAPâ€‘Kenya Â· East Africa Â· Live Destination Maps</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts Â· Inter clean -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js 4.4 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Leaflet Â· East Africa map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: #f3fafc;
            color: #0e4a5a;
            line-height: 1.55;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }
        .container { 
            max-width: 1650px; 
            margin: 0 auto; 
            width: 100%;
            padding: 28px 24px;
        }

        /* ----- AUTH PAGES (LOGIN + SIGNUP) ----- */
        .auth-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(145deg, #0a5656 0%, #1a7a7a 100%);
            padding: 20px;
        }
        .auth-card {
            background: white;
            border-radius: 48px 24px 48px 24px;
            padding: 48px 44px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 30px 50px rgba(0,0,0,0.2);
            border-left: 16px solid #f4c542;
        }
        .auth-logo {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }
        .auth-logo i {
            font-size: 52px;
            color: #1e7e7e;
        }
        .auth-logo h1 {
            font-size: 32px;
            font-weight: 700;
            color: #0a4a4a;
        }
        .auth-tabs {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            border-bottom: 2px solid #e0ecea;
            padding-bottom: 16px;
        }
        .auth-tab {
            font-size: 20px;
            font-weight: 700;
            color: #0a5e5e;
            padding: 8px 24px;
            border-radius: 60px;
            cursor: pointer;
            transition: 0.2s;
        }
        .auth-tab.active {
            background: #116466;
            color: white;
        }
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .input-group label {
            font-weight: 600;
            color: #0e5e5e;
            font-size: 16px;
        }
        .input-group input {
            padding: 16px 24px;
            border: 2px solid #cde3df;
            border-radius: 60px;
            font-size: 16px;
            transition: 0.2s;
            font-family: 'Inter', sans-serif;
        }
        .input-group input:focus {
            border-color: #1b7e7e;
            outline: none;
            box-shadow: 0 0 0 3px rgba(27,126,126,0.1);
        }
        .auth-btn {
            background: #1b7e7e;
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 60px;
            font-weight: 700;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            transition: 0.2s;
            margin-top: 16px;
        }
        .auth-btn:hover {
            background: #0e5e5e;
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -8px #0a5e5e;
        }
        .auth-message {
            text-align: center;
            margin-top: 24px;
            font-size: 16px;
            color: #2e6d6d;
            font-weight: 500;
        }
        .auth-message span {
            color: #1b7e7e;
            font-weight: 700;
            cursor: pointer;
            text-decoration: underline;
        }
        .hidden {
            display: none !important;
        }

        /* ----- MAIN APP CONTENT ----- */
        .app-wrapper {
            display: block;
        }
        .app-wrapper.hidden {
            display: none;
        }

        /* ----- HEADER â€“ FULLY VISIBLE ----- */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 28px;
            flex-wrap: wrap;
            background: linear-gradient(155deg, #0c5e5e 0%, #1a7a7a 100%);
            padding: 28px 44px;
            border-radius: 36px 16px 36px 16px;
            box-shadow: 0 16px 28px -12px rgba(8,70,70,0.2);
            color: white;
            width: 100%;
            gap: 24px;
        }
        .logo-area { 
            display: flex; 
            align-items: center; 
            gap: 20px; 
            flex-wrap: wrap;
        }
        .logo-icon { 
            font-size: 58px; 
            color: #ffe999; 
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.08)); 
        }
        .logo-text h1 { 
            font-size: 36px; 
            font-weight: 700; 
            letter-spacing: -0.02em; 
            margin-bottom: 6px; 
            line-height: 1.2;
        }
        .logo-text span { 
            background: #2ea0a0; 
            padding: 8px 22px; 
            border-radius: 40px; 
            font-weight: 500; 
            font-size: 16px;
            display: inline-block;
        }

        .header-stats {
            display: flex;
            gap: 44px;
            background: rgba(255,255,255,0.15);
            padding: 18px 40px;
            border-radius: 80px;
            backdrop-filter: blur(4px);
            flex-wrap: wrap;
        }
        .stat-item { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        .stat-value { 
            font-size: 34px; 
            font-weight: 800; 
            line-height: 1.2;
        }
        .stat-label { 
            font-size: 14px; 
            opacity: 0.95; 
            letter-spacing: 0.4px;
            font-weight: 500;
        }

        /* ----- GREETING CARD â€“ BOLD, CENTERED ----- */
        .greeting-card {
            background: linear-gradient(105deg, #fff9e7 0%, #fffef5 100%);
            border-radius: 60px 20px 60px 20px;
            padding: 28px 44px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 28px;
            flex-wrap: wrap;
            border-left: 14px solid #ffae42;
            box-shadow: 0 12px 28px rgba(255,160,60,0.15);
            width: 100%;
        }
        .greeting-avatar {
            background: #2a9d8f;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            box-shadow: 0 10px 0 #1e6e5e;
        }
        .greeting-text {
            font-size: 32px;
            font-weight: 700;
            color: #0a4a4a;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .greeting-text span {
            background: #ffeaa5;
            padding: 10px 28px;
            border-radius: 60px;
            font-size: 30px;
            display: inline-block;
        }
        .greeting-emoji {
            font-size: 48px;
            margin-left: 8px;
        }

        /* grid â€“ clean spacing */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            gap: 28px; 
            margin-bottom: 28px; 
            width: 100%;
        }
        .card {
            background: white; 
            border-radius: 28px; 
            padding: 28px;
            box-shadow: 0 8px 24px rgba(0,70,70,0.04); 
            border: 1px solid rgba(40,130,130,0.1);
            transition: border 0.2s, box-shadow 0.2s;
        }
        .card:hover { 
            border-color: #2a9d8fc0; 
            box-shadow: 0 14px 26px -8px #1b7e7e20; 
        }
        .col-span-3 { grid-column: span 3; }
        .col-span-4 { grid-column: span 4; }
        .col-span-5 { grid-column: span 5; }
        .col-span-6 { grid-column: span 6; }
        .col-span-7 { grid-column: span 7; }
        .col-span-8 { grid-column: span 8; }
        .col-span-12 { grid-column: span 12; }

        .section-title {
            display: flex; 
            align-items: center; 
            gap: 12px; 
            font-weight: 600; 
            font-size: 20px;
            color: #0f5959; 
            border-bottom: 3px solid #dcf2ef; 
            padding-bottom: 14px; 
            margin-bottom: 24px;
        }
        .section-title i { 
            color: #1e8a7a; 
            font-size: 24px; 
        }

        .pref-tags { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 12px; 
            margin: 20px 0; 
        }
        .tag {
            background: white; 
            border: 1.8px solid #cde3df; 
            padding: 10px 24px; 
            border-radius: 40px;
            font-size: 15px; 
            font-weight: 600; 
            color: #0e5e5e; 
            transition: 0.1s; 
            cursor: pointer;
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
        }
        .tag.active { 
            background: #116466; 
            border-color: #116466; 
            color: white; 
        }

        .btn {
            border: none; 
            background: #1b7e7e; 
            color: white; 
            padding: 14px 32px; 
            border-radius: 50px;
            font-weight: 600; 
            display: inline-flex; 
            align-items: center; 
            gap: 12px; 
            cursor: pointer;
            transition: 0.2s; 
            font-size: 16px;
        }
        .btn:hover { 
            background: #0e5e5e; 
            transform: translateY(-1px); 
            box-shadow: 0 12px 18px -6px #0a5e5e60; 
        }
        .btn-outline { 
            background: white; 
            border: 2px solid #1b7e7e; 
            color: #1b7e7e; 
        }
        .btn-outline:hover { 
            background: #e0f2f0; 
        }

        .itinerary-card {
            background: white; 
            border-radius: 24px; 
            padding: 24px; 
            margin: 20px 0 8px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.02); 
            border-left: 12px solid #2a9d8f;
        }
        .eco-score { 
            background: #2f6d5a; 
            color: white; 
            font-weight: 600; 
            padding: 8px 22px; 
            border-radius: 60px; 
            font-size: 15px; 
        }

        .congestion-meter {
            background: #fff9ed; 
            border-radius: 60px; 
            padding: 18px 26px; 
            display: flex; 
            align-items: center; 
            gap: 20px;
        }
        .meter-bar { 
            flex: 1; 
            height: 26px; 
            background: #ffe9ce; 
            border-radius: 40px; 
            overflow: hidden; 
        }
        .meter-fill { 
            height: 100%; 
            background: #e76f51; 
            border-radius: 40px; 
            width: 0%; 
            transition: width 0.2s; 
        }

        .map-container { 
            height: 300px; 
            border-radius: 24px; 
            margin-top: 12px; 
            border: 2px solid #cde9e5; 
            z-index: 1; 
        }
        .footer {
            text-align: center; 
            margin-top: 60px; 
            color: #2e6d6d; 
            font-size: 16px;
            padding-top: 32px; 
            border-top: 2px solid #c7e6e0;
        }

        /* tabs â€“ fully visible */
        .tabs {
            display: flex; 
            gap: 14px; 
            margin-bottom: 32px; 
            border-bottom: 2px solid #d0ece5; 
            padding-bottom: 16px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 14px 32px; 
            background: white; 
            border-radius: 60px 60px 20px 20px;
            font-weight: 600; 
            color: #0e5e5e; 
            border: 1.8px solid transparent; 
            cursor: pointer;
            transition: 0.1s; 
            font-size: 16px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
        }
        .tab.active { 
            background: #116466; 
            color: white; 
            border-color: #0b4a4a; 
        }
        .tab i { 
            margin-right: 10px; 
        }

        .tab-content { 
            display: block; 
        }
        .tab-content.hidden { 
            display: none; 
        }

        /* destination grid â€“ 30+ sites with precise locations */
        .dest-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); 
            gap: 18px; 
            margin-top: 24px;
        }
        .dest-item {
            background: #f1f9f7; 
            padding: 18px 20px; 
            border-radius: 28px; 
            border-left: 10px solid #2a9d8f;
            font-weight: 500; 
            display: flex; 
            align-items: center; 
            gap: 14px;
            font-size: 16px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            cursor: pointer;
            transition: 0.2s;
        }
        .dest-item:hover {
            background: #e0f2ef;
            transform: translateY(-2px);
            border-left-color: #e76f51;
        }
        .dest-item i { 
            color: #1e7e7e; 
            width: 30px; 
            text-align: center; 
            font-size: 22px; 
        }
        .location-badge {
            font-size: 12px;
            background: #d0ece5;
            padding: 4px 10px;
            border-radius: 40px;
            color: #0a4a4a;
            margin-left: 8px;
            font-weight: 600;
        }

        /* responsive */
        @media (max-width: 1200px) {
            .header, .greeting-card { padding: 24px 28px; }
            .logo-text h1 { font-size: 30px; }
            .greeting-text { font-size: 28px; }
        }
        @media (max-width: 1000px) { 
            .grid { display: block; } 
            .col-span-3,.col-span-4,.col-span-5,.col-span-6,
            .col-span-7,.col-span-8 { width:100%; margin-bottom:28px; }
            .header-stats { margin-top: 12px; width: 100%; justify-content: center; }
        }
        @media (max-width: 700px) {
            .auth-card { padding: 32px 24px; }
            .greeting-avatar { width: 70px; height: 70px; font-size: 40px; }
        }
    </style>
</head>
<body>
    <!-- ========== LOGIN / SIGNUP PAGE ========= -->
    <div id="authContainer" class="auth-wrapper">
        <div class="auth-card">
            <div class="auth-logo">
                <i class="fas fa-compass"></i>
                <h1>STAPâ€‘Kenya</h1>
            </div>
            
            <!-- Login / Signup Tabs -->
            <div class="auth-tabs">
                <div id="loginTabBtn" class="auth-tab active" onclick="showLogin()">Login</div>
                <div id="signupTabBtn" class="auth-tab" onclick="showSignup()">Create Account</div>
            </div>

            <!-- LOGIN FORM -->
            <div id="loginForm" class="auth-form">
                <div class="input-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="loginEmail" placeholder="your@email.com" autocomplete="email">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
                </div>
                <button class="auth-btn" onclick="handleLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <div class="auth-message">
                    Don't have an account? <span onclick="showSignup()">Sign up</span>
                </div>
            </div>

            <!-- SIGNUP FORM -->
            <div id="signupForm" class="auth-form hidden">
                <div class="input-group">
                    <label><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="signupName" placeholder="e.g. Nicole Wema" autocomplete="name">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="signupEmail" placeholder="your@email.com" autocomplete="email">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="signupPassword" placeholder="at least 6 characters" autocomplete="new-password">
                </div>
                <button class="auth-btn" onclick="handleSignup()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                <div class="auth-message">
                    Already have an account? <span onclick="showLogin()">Login</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== MAIN APP (hidden until login) ========= -->
    <div id="appContainer" class="app-wrapper hidden">
        <div class="container">
            <!-- ========== HEADER ========= -->
            <div class="header">
                <div class="logo-area">
                    <i class="fas fa-compass logo-icon"></i>
                    <div class="logo-text">
                        <h1>STAPâ€‘Kenya Â· East Africa</h1>
                        <span><i class="fas fa-globe-africa"></i> 30+ destinations Â· AI Â· predictive Â· offline</span>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="headerCongestion">-32%</span>
                        <span class="stat-label">peak congestion</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="headerEco">91</span>
                        <span class="stat-label">avg. ecoâ€‘score</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="headerCommunity">+64%</span>
                        <span class="stat-label">community rev.</span>
                    </div>
                </div>
            </div>

            <!-- ========== GREETING CARD â€“ DYNAMIC WITH USER NAME ========= -->
            <div class="greeting-card" id="greetingContainer">
                <div class="greeting-avatar">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="greeting-text" id="greetingMessage">
                    <!-- dynamic greeting -->
                </div>
                <span class="greeting-emoji" id="greetingEmoji">ğŸ‘ğŸ˜Š</span>
            </div>

            <!-- ========== TABS ========= -->
            <div class="tabs">
                <div class="tab active" data-tab="tab1"><i class="fas fa-robot"></i> AI itinerary</div>
                <div class="tab" data-tab="tab2"><i class="fas fa-chart-line"></i> predictive + crowd</div>
                <div class="tab" data-tab="tab3"><i class="fas fa-store"></i> marketplace</div>
                <div class="tab" data-tab="tab4"><i class="fas fa-leaf"></i> sustainability</div>
                <div class="tab" data-tab="tab5"><i class="fas fa-cloud-moon"></i> offline & edge</div>
                <div class="tab" data-tab="tab6"><i class="fas fa-map-marked-alt"></i> live destination maps</div>
            </div>

            <!-- ========== TAB 1 Â· AI ITINERARY ========= -->
            <div id="tab1" class="tab-content">
                <div class="grid">
                    <div class="col-span-7 card">
                        <div class="section-title"><i class="fas fa-robot"></i> AI recommendation Â· 30+ East African destinations</div>
                        <div style="background:#f6fdfb; border-radius:28px; padding:26px;">
                            <div style="display:flex; justify-content:space-between; flex-wrap:wrap;">
                                <span style="font-weight:600;"><i class="fas fa-sliders-h"></i> traveler preferences</span>
                                <span id="prefSummary" style="background:#c6ece6; padding:6px 24px; border-radius:60px; font-weight:500;">ğŸ¦ wildlife Â· ğŸ•ï¸ cultural</span>
                            </div>
                            <div class="pref-tags" id="prefTags">
                                <span class="tag active" data-pref="wildlife">ğŸ¦ Wildlife</span>
                                <span class="tag active" data-pref="cultural">ğŸ•ï¸ Cultural</span>
                                <span class="tag" data-pref="adventure">ğŸ§— Adventure</span>
                                <span class="tag" data-pref="beach">ğŸ–ï¸ Beach</span>
                                <span class="tag" data-pref="birding">ğŸ¦© Birding</span>
                                <span class="tag" data-pref="historical">ğŸ›ï¸ Historical</span>
                                <span class="tag" data-pref="hiking">ğŸ¥¾ Hiking</span>
                            </div>
                            <div style="display:flex; gap:16px; flex-wrap:wrap;">
                                <button class="btn" id="generateBtn"><i class="fas fa-magic"></i> generate East Africa itinerary</button>
                                <button class="btn-outline btn" id="randomPrefBtn"><i class="fas fa-dice"></i> random explorer</button>
                                <button class="btn-outline btn" id="resetPrefBtn"><i class="fas fa-undo-alt"></i> reset</button>
                            </div>
                            <div id="itineraryOutput"></div>
                        </div>
                    </div>
                    <div class="col-span-5 card">
                        <div class="section-title"><i class="fas fa-cloud-sun"></i> realâ€‘time context Â· East Africa</div>
                        <div style="background:#f1faf8; border-radius:28px; padding:26px;">
                            <div style="display:flex; justify-content:space-between; flex-wrap:wrap;">
                                <span><i class="fas fa-temperature-low"></i> Nairobi 24Â°C ğŸŒ¤ï¸ Â· Mara 27Â°C â˜€ï¸</span>
                                <span style="background:#e7e7e7; padding:6px 20px; border-radius:60px;"><i class="fas fa-users"></i> crowd 71%</span>
                            </div>
                            <div style="margin-top:28px;">
                                <div style="display:flex; gap:16px; flex-direction:column;">
                                    <span><i class="fas fa-map-pin"></i> <strong>ğŸ‡°ğŸ‡ª Maasai Mara:</strong> 71% capacity Â· diversion active</span>
                                    <span><i class="fas fa-map-pin"></i> <strong>ğŸ‡°ğŸ‡ª Amboseli:</strong> 56% Â· ğŸ”ï¸ Kilimanjaro views</span>
                                    <span><i class="fas fa-map-pin"></i> <strong>ğŸ‡¹ğŸ‡¿ Zanzibar:</strong> 48% Â· ğŸ›ï¸ Stone Town</span>
                                    <span><i class="fas fa-map-pin"></i> <strong>ğŸ‡°ğŸ‡ª Lamu:</strong> 34% Â· â›µ dhow cruises</span>
                                    <span><i class="fas fa-map-pin"></i> <strong>ğŸ‡¹ğŸ‡¿ Ngorongoro:</strong> 62% Â· ğŸŒ‹ crater floor</span>
                                </div>
                            </div>
                            <div style="margin-top:28px; background:#e0f0ea; padding:18px; border-radius:20px;">
                                <i class="fas fa-lightbulb" style="color:#e09b2e;"></i> 
                                adaptive intelligence: 30+ destinations across Kenya, Tanzania, Zanzibar ğŸ—ºï¸
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB 2 Â· PREDICTIVE + CROWD (with live map) ========= -->
            <div id="tab2" class="tab-content hidden">
                <div class="grid">
                    <div class="col-span-7 card">
                        <div class="section-title"><i class="fas fa-chart-line"></i> predictive analytics Â· East Africa crowd management</div>
                        <div style="display:flex; gap:14px; margin-bottom:24px; flex-wrap:wrap;">
                            <select id="gateSelectorTab2" style="padding:14px 26px; border-radius:80px; border:2px solid #279098; font-weight:500; flex:2; min-width:280px;">
                                <optgroup label="ğŸ‡°ğŸ‡ª KENYA (19 sites)">
                                    <option value="mara" selected>Maasai Mara - Sekenani Gate</option>
                                    <option value="amboseli">Amboseli - Kimana Gate</option>
                                    <option value="tsavo">Tsavo East/West</option>
                                    <option value="samburu">Samburu - Ewaso Ng'iro</option>
                                    <option value="meru">Meru National Park</option>
                                    <option value="shaba">Shaba Reserve</option>
                                    <option value="nakuru">Lake Nakuru</option>
                                    <option value="naivasha">Lake Naivasha</option>
                                    <option value="aberdare">Aberdare - Treetops</option>
                                    <option value="mtkenya">Mount Kenya</option>
                                    <option value="kakamega">Kakamega Forest</option>
                                    <option value="watamu">Watamu Marine</option>
                                    <option value="lamu">Lamu Island</option>
                                    <option value="kisumu">Kisumu - Lake Vic</option>
                                    <option value="turkana">Turkana - Jade Sea</option>
                                    <option value="matthews">Matthews Range</option>
                                    <option value="lewa">Lewa Conservancy</option>
                                    <option value="arabuko">Arabuko-Sokoke</option>
                                    <option value="giraffe">Giraffe Centre (NBI)</option>
                                </optgroup>
                                <optgroup label="ğŸ‡¹ğŸ‡¿ TANZANIA / ZANZIBAR (11 sites)">
                                    <option value="ngorongoro">Ngorongoro Crater</option>
                                    <option value="serengeti">Serengeti NP</option>
                                    <option value="zanzibar">Zanzibar - Stone Town</option>
                                    <option value="pemba">Pemba Island</option>
                                    <option value="bagamoyo">Bagamoyo</option>
                                    <option value="kilwa">Kilwa Kisiwani</option>
                                    <option value="pangani">Pangani</option>
                                    <option value="manyara">Lake Manyara</option>
                                    <option value="tarangire">Tarangire</option>
                                    <option value="selous">Selous</option>
                                    <option value="kilimanjaro">Mount Kilimanjaro</option>
                                </optgroup>
                            </select>
                            <span style="background:#1b7e7e; color:white; padding:14px 32px; border-radius:80px; font-weight:700; font-size:20px;" id="liveCongestionPercentTab2">68%</span>
                        </div>
                        <div class="congestion-meter">
                            <i class="fas fa-users" style="font-size:36px; color:#e76f51;"></i>
                            <div style="flex:1">
                                <div style="display:flex; justify-content:space-between;">
                                    <span id="gateNameDisplayTab2" style="font-weight:700; font-size:18px;">Maasai Mara</span>
                                    <span style="font-weight:700; color:#c44536; font-size:18px;" id="congestionTextTab2">68% capacity</span>
                                </div>
                                <div class="meter-bar"><div class="meter-fill" id="congestionFillTab2" style="width:68%;"></div></div>
                            </div>
                        </div>
                        <div style="margin:32px 0 20px;">
                            <span style="font-weight:700; font-size:18px;"><i class="fas fa-arrows-spread"></i> AI demand forecasting Â· diversion simulator</span>
                            <input type="range" id="diversionSliderTab2" min="0" max="45" value="32" style="width:100%; accent-color:#2a9d8f; margin-top:18px; height:8px;">
                            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                                <span>ğŸ“Š static</span>
                                <span style="font-weight:700; color:#1b7e7e; font-size:20px;" id="diversionValueTab2">-32% congestion</span>
                                <span>ğŸ¤– max AI</span>
                            </div>
                        </div>
                        <div id="alertMessageTab2" style="background:#e6f6f2; border-radius:28px; padding:22px; font-size:17px;">
                            <i class="fas fa-bolt"></i> LSTM forecast: 1,180 vehicles diverted Â· 94% accuracy
                        </div>
                    </div>
                    <div class="col-span-5 card">
                        <div class="section-title"><i class="fas fa-map-marked-alt"></i> live crowding index Â· precise location</div>
                        <div id="mapTab2" class="map-container" style="height:300px;"></div>
                        <div style="margin-top:20px; display:flex; justify-content:space-between;">
                            <span><i class="fas fa-map-pin"></i> <span id="markerCoords">-1.406, 35.0</span></span>
                            <span style="background:#e2f0ee; padding:6px 18px; border-radius:60px;"><i class="fas fa-crosshairs"></i> 19 Kenya Â· 11 Tanzania</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB 3 Â· MARKETPLACE ========= -->
            <div id="tab3" class="tab-content hidden">
                <div class="grid">
                    <div class="col-span-6 card">
                        <div class="section-title"><i class="fas fa-store-alt"></i> community marketplace Â· East Africa ğŸ¤</div>
                        <div style="display:flex; align-items:center; gap:28px; background:#f1fbf9; padding:28px; border-radius:48px;">
                            <div style="background:#1e7e7e; width:100px; height:100px; border-radius:36px; display:flex; align-items:center; justify-content:center; color:white;">
                                <i class="fas fa-hand-holding-heart fa-4x"></i>
                            </div>
                            <div>
                                <div style="font-weight:800; font-size:52px;" id="communityCountTab3">92</div>
                                <span style="color:#0d5e5e; font-size:20px;">community enterprises</span>
                            </div>
                        </div>
                        <div style="margin-top:36px;">
                            <div style="display:flex; justify-content:space-between; background:white; padding:18px 28px; border-radius:48px; border:1.5px solid #b7dfd9; align-items:center;">
                                <span><i class="fas fa-map-pin"></i> ğŸ‡°ğŸ‡ª Turkana homestays</span>
                                <span style="font-weight:800; font-size:24px;" id="turkanaBookingsTab3">+188%</span>
                                <button class="btn" id="boostTurkanaBtn" style="padding:10px 24px;">ğŸ“ˆ boost</button>
                            </div>
                            <div style="display:flex; justify-content:space-between; margin-top:18px; background:white; padding:18px 28px; border-radius:48px; border:1.5px solid #b7dfd9; align-items:center;">
                                <span><i class="fas fa-map-pin"></i> ğŸ‡°ğŸ‡ª Lamu dhow operators</span>
                                <span style="font-weight:800; font-size:24px;" id="lamuBookings">+172%</span>
                                <button class="btn" id="boostLamuBtn" style="padding:10px 24px;">ğŸ“ˆ boost</button>
                            </div>
                            <div style="display:flex; justify-content:space-between; margin-top:18px; background:white; padding:18px 28px; border-radius:48px; border:1.5px solid #b7dfd9; align-items:center;">
                                <span><i class="fas fa-map-pin"></i> ğŸ‡¹ğŸ‡¿ Zanzibar spice farms</span>
                                <span style="font-weight:800; font-size:24px;" id="zanzibarBookings">+218%</span>
                                <button class="btn" id="boostZanzibarBtn" style="padding:10px 24px;">ğŸ“ˆ boost</button>
                            </div>
                            <div style="display:flex; justify-content:space-between; margin-top:18px; background:white; padding:18px 28px; border-radius:48px; border:1.5px solid #b7dfd9; align-items:center;">
                                <span><i class="fas fa-map-pin"></i> ğŸ‡°ğŸ‡ª Maasai Mara conservancies</span>
                                <span style="font-weight:800; font-size:24px;" id="maraBookings">+204%</span>
                                <button class="btn" id="boostMaraBtn" style="padding:10px 24px;">ğŸ“ˆ boost</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-span-6 card">
                        <div class="section-title"><i class="fas fa-money-bill-wave"></i> unified payment Â· Mâ€‘Pesa Â· EAC ğŸ’¸</div>
                        <div style="background:#c5efe5; border-radius:48px; padding:36px;">
                            <span style="font-size:22px; font-weight:700;"><i class="fas fa-mobile-alt"></i> Mâ€‘Pesa Â· Airtel Â· Tigo</span>
                            <div style="font-size:64px; font-weight:800; margin-top:20px;" id="mpesaVolumeTab3">KES 284.6K</div>
                            <span style="font-size:20px;">last hour Â· <span id="bookingCountTab3">178</span> community bookings ğŸ›’</span>
                            <div style="margin-top:32px;"><button class="btn" id="simulateBookingBtn" style="font-size:18px;"><i class="fas fa-plus-circle"></i> new booking âœ¨</button></div>
                        </div>
                        <div style="margin-top:32px; background:#feedcf; border-radius:48px; padding:32px;">
                            <i class="fas fa-cubes fa-2x"></i> 
                            <span style="font-weight:800; font-size:40px;" id="creditMintedTab3">2,680</span> conservation credits ğŸŒ³
                            <div style="margin-top:14px; font-size:18px;">tokenized offset Â· reforestation Â· Kenya/Tanzania ğŸŒ</div>
                            <button class="btn-outline btn" id="mintCreditBtn" style="margin-top:24px; padding:14px 32px;"><i class="fas fa-coins"></i> mint 5 credits â›“ï¸</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB 4 Â· SUSTAINABILITY ========= -->
            <div id="tab4" class="tab-content hidden">
                <div class="grid">
                    <div class="col-span-6 card">
                        <div class="section-title"><i class="fas fa-leaf"></i> sustainability scoring Â· East Africa ğŸŒ¿</div>
                        <div style="display:flex; gap:60px; align-items:center; flex-wrap:wrap;">
                            <div style="text-align:center;">
                                <span style="font-size:96px; font-weight:800; color:#1e6e5e;" id="ecoScoreTab4">91</span>
                                <span style="font-size:32px;">/100</span>
                                <div><span class="eco-score" id="ecoBadgeTab4" style="font-size:18px; padding:10px 30px;">ğŸŒ¿ gold</span></div>
                            </div>
                            <div style="font-size:20px;">
                                <div>ğŸŒ«ï¸ carbon <span id="carbonTab4">84 kg</span></div>
                                <div>ğŸ’§ water <span id="waterTab4">228 L</span></div>
                                <div>ğŸ—‘ï¸ waste <span id="wasteTab4">1.6 kg</span></div>
                                <div>ğŸ¦‹ biodiversity <span id="bioTab4">89</span></div>
                            </div>
                        </div>
                        <button class="btn" id="optimizeGreenBtnTab4" style="margin-top:40px; width:100%; padding:18px; font-size:18px;"><i class="fas fa-recycle"></i> recommend responsible choices â™»ï¸</button>
                        <div style="margin-top:28px; background:#e0f0ea; padding:24px; border-radius:28px; font-size:17px;">
                            <i class="fas fa-check-circle" style="color:#2a7a5a;"></i> electric safari ğŸš™ Â· ecoâ€‘lodges ğŸ•ï¸ Â· reefâ€‘safe snorkeling ğŸ¤¿
                        </div>
                    </div>
                    <div class="col-span-6 card">
                        <div class="section-title"><i class="fas fa-chart-pie"></i> trip ecoâ€‘score breakdown ğŸ“Š</div>
                        <div style="background:#e8f5f2; border-radius:40px; padding:28px;">
                            <canvas id="ecoChart" style="height:200px; width:100%;"></canvas>
                            <div style="margin-top:32px; display:flex; gap:24px; flex-wrap:wrap; justify-content:center;">
                                <span style="background:white; padding:12px 28px; border-radius:60px; font-size:16px;"><i class="fas fa-car"></i> transport 34%</span>
                                <span style="background:white; padding:12px 28px; border-radius:60px; font-size:16px;"><i class="fas fa-hotel"></i> accommodation 28%</span>
                                <span style="background:white; padding:12px 28px; border-radius:60px; font-size:16px;"><i class="fas fa-utensils"></i> dining 22%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== TAB 5 Â· OFFLINE & EDGE ========= -->
            <div id="tab5" class="tab-content hidden">
                <div class="grid">
                    <div class="col-span-6 card">
                        <div class="section-title"><i class="fas fa-cloud-moon"></i> offlineâ€‘first Â· rural East Africa ğŸ“¡</div>
                        <div style="display:flex; gap:36px; align-items:center; flex-wrap:wrap;">
                            <i class="fas fa-database" style="font-size:88px; color:#156565;"></i>
                            <div><span style="font-size:56px; font-weight:800;" id="cacheCountTab5">792</span> <span style="font-size:22px;">recommendations cached ğŸ’¾</span></div>
                        </div>
                        <div style="background:#d7f0ec; margin-top:36px; padding:28px; border-radius:48px;">
                            <i class="fas fa-solar-panel" style="font-size:28px;"></i> solar edge nodes: <span style="font-weight:800; font-size:28px;" id="edgeNodesTab5">26</span> deployed â˜€ï¸ Â· Turkana, Lamu, Ngorongoro, Zanzibar
                            <div style="margin-top:20px; font-size:20px;">â¬‡ï¸ background sync queue: <span style="font-weight:800;" id="syncQueueTab5">11</span> pending â³</div>
                            <button class="btn" id="simulateOfflineBtn" style="margin-top:28px; padding:16px 36px; font-size:18px;"><i class="fas fa-wifi-slash"></i> simulate offline mode ğŸ“´</button>
                        </div>
                    </div>
                    <div class="col-span-6 card">
                        <div class="section-title"><i class="fas fa-cloud-upload-alt"></i> scalable cloud Â· East Africa hub â˜ï¸</div>
                        <div style="display:flex; gap:20px; flex-wrap:wrap;">
                            <span style="background:white; border:2px solid #279098; padding:16px 32px; border-radius:80px; font-size:17px;"><i class="fas fa-kubernetes"></i> K8s autoâ€‘scale</span>
                            <span style="background:white; border:2px solid #279098; padding:16px 32px; border-radius:80px; font-size:17px;"><i class="fas fa-globe"></i> Nairobi Â· Dar Â· Zanzibar</span>
                            <span style="background:white; border:2px solid #279098; padding:16px 32px; border-radius:80px; font-size:17px;"><i class="fas fa-chart-simple"></i> horizontal scaling</span>
                        </div>
                        <div style="margin-top:44px; background:#fcf2de; border-radius:40px; padding:28px;">
                            <span style="font-weight:800; font-size:24px;">ğŸ’° hybrid revenue model</span><br>
                            <span style="font-size:18px;">operator subscriptions Â· transaction commissions Â· institutional licensing</span>
                        </div>
                        <button class="btn" id="deployNodeBtn" style="margin-top:36px; padding:16px 36px; font-size:18px;"><i class="fas fa-plus-circle"></i> add edge node â•</button>
                    </div>
                </div>
            </div>

            <!-- ========== TAB 6 Â· LIVE DESTINATION MAPS â€“ 30+ SITES WITH PRECISE LOCATIONS ========= -->
            <div id="tab6" class="tab-content hidden">
                <div class="grid">
                    <div class="col-span-12 card">
                        <div class="section-title"><i class="fas fa-map-marked-alt"></i> East Africa Â· 30+ Destinations with Live Locations</div>
                        <div style="display:flex; gap:20px; margin-bottom:24px; flex-wrap:wrap;">
                            <span style="background:#116466; color:white; padding:10px 28px; border-radius:60px;"><i class="fas fa-flag"></i> ğŸ‡°ğŸ‡ª Kenya (19) Â· precise coordinates</span>
                            <span style="background:#0e7e7e; color:white; padding:10px 28px; border-radius:60px;"><i class="fas fa-flag"></i> ğŸ‡¹ğŸ‡¿ Tanzania / Zanzibar (11) Â· precise coordinates</span>
                        </div>
                        
                        <!-- Interactive Map for All Destinations -->
                        <div id="mapAllDestinations" class="map-container" style="height:350px; margin-bottom:30px;"></div>
                        
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                            <h3 style="font-weight:700; color:#0f5959;"><i class="fas fa-list"></i> Click any destination to locate on map</h3>
                            <span style="background:#e2f0ee; padding:8px 24px; border-radius:60px;"><i class="fas fa-crosshairs"></i> 30 active markers</span>
                        </div>
                        
                        <div class="dest-grid">
                            <!-- KENYA - 19 sites with precise coordinates in data attributes -->
                            <div class="dest-item" data-lat="-1.406" data-lng="35.0" data-name="Maasai Mara">
                                <i class="fas fa-paw"></i> ğŸ¦ Maasai Mara <span class="location-badge">-1.406, 35.0</span>
                            </div>
                            <div class="dest-item" data-lat="-2.638" data-lng="37.262" data-name="Amboseli">
                                <i class="fas fa-elephant"></i> ğŸ˜ Amboseli <span class="location-badge">-2.638, 37.262</span>
                            </div>
                            <div class="dest-item" data-lat="-3.347" data-lng="38.136" data-name="Tsavo East/West">
                                <i class="fas fa-tree"></i> ğŸŒ³ Tsavo <span class="location-badge">-3.347, 38.136</span>
                            </div>
                            <div class="dest-item" data-lat="0.6" data-lng="37.5" data-name="Samburu">
                                <i class="fas fa-water"></i> ğŸ’§ Samburu <span class="location-badge">0.6, 37.5</span>
                            </div>
                            <div class="dest-item" data-lat="0.1" data-lng="38.2" data-name="Meru">
                                <i class="fas fa-mountain"></i> ğŸ”ï¸ Meru <span class="location-badge">0.1, 38.2</span>
                            </div>
                            <div class="dest-item" data-lat="0.65" data-lng="37.6" data-name="Shaba">
                                <i class="fas fa-paw"></i> ğŸ† Shaba <span class="location-badge">0.65, 37.6</span>
                            </div>
                            <div class="dest-item" data-lat="-0.3" data-lng="36.1" data-name="Lake Nakuru">
                                <i class="fas fa-dove"></i> ğŸ¦© Lake Nakuru <span class="location-badge">-0.3, 36.1</span>
                            </div>
                            <div class="dest-item" data-lat="-0.7" data-lng="36.4" data-name="Lake Naivasha">
                                <i class="fas fa-water"></i> ğŸŒ… Lake Naivasha <span class="location-badge">-0.7, 36.4</span>
                            </div>
                            <div class="dest-item" data-lat="-0.4" data-lng="36.7" data-name="Aberdare">
                                <i class="fas fa-tree"></i> ğŸŒ² Aberdare <span class="location-badge">-0.4, 36.7</span>
                            </div>
                            <div class="dest-item" data-lat="0.1" data-lng="37.3" data-name="Mount Kenya">
                                <i class="fas fa-mountain"></i> â›°ï¸ Mt Kenya <span class="location-badge">0.1, 37.3</span>
                            </div>
                            <div class="dest-item" data-lat="0.28" data-lng="34.75" data-name="Kakamega">
                                <i class="fas fa-leaf"></i> ğŸŒ¿ Kakamega <span class="location-badge">0.28, 34.75</span>
                            </div>
                            <div class="dest-item" data-lat="-3.35" data-lng="40.02" data-name="Watamu">
                                <i class="fas fa-fish"></i> ğŸ  Watamu <span class="location-badge">-3.35, 40.02</span>
                            </div>
                            <div class="dest-item" data-lat="-2.27" data-lng="40.9" data-name="Lamu">
                                <i class="fas fa-ship"></i> â›µ Lamu <span class="location-badge">-2.27, 40.9</span>
                            </div>
                            <div class="dest-item" data-lat="-0.09" data-lng="34.75" data-name="Kisumu">
                                <i class="fas fa-dove"></i> ğŸŸ Kisumu <span class="location-badge">-0.09, 34.75</span>
                            </div>
                            <div class="dest-item" data-lat="3.12" data-lng="35.6" data-name="Turkana">
                                <i class="fas fa-desert"></i> ğŸœï¸ Turkana <span class="location-badge">3.12, 35.6</span>
                            </div>
                            <div class="dest-item" data-lat="1.9" data-lng="37.2" data-name="Matthews">
                                <i class="fas fa-hiking"></i> ğŸ¥¾ Matthews <span class="location-badge">1.9, 37.2</span>
                            </div>
                            <div class="dest-item" data-lat="0.2" data-lng="37.1" data-name="Lewa">
                                <i class="fas fa-shield"></i> ğŸ›¡ï¸ Lewa <span class="location-badge">0.2, 37.1</span>
                            </div>
                            <div class="dest-item" data-lat="-3.3" data-lng="39.95" data-name="Arabuko">
                                <i class="fas fa-forest"></i> ğŸŒ³ Arabuko <span class="location-badge">-3.3, 39.95</span>
                            </div>
                            <div class="dest-item" data-lat="-1.33" data-lng="36.78" data-name="Giraffe Centre">
                                <i class="fas fa-landmark"></i> ğŸ¦’ Giraffe Centre <span class="location-badge">-1.33, 36.78</span>
                            </div>
                            <!-- TANZANIA / ZANZIBAR - 11 sites -->
                            <div class="dest-item" data-lat="-3.2" data-lng="35.5" data-name="Ngorongoro">
                                <i class="fas fa-crater"></i> ğŸŒ‹ Ngorongoro <span class="location-badge">-3.2, 35.5</span>
                            </div>
                            <div class="dest-item" data-lat="-2.3" data-lng="34.8" data-name="Serengeti">
                                <i class="fas fa-paw"></i> ğŸ¦“ Serengeti <span class="location-badge">-2.3, 34.8</span>
                            </div>
                            <div class="dest-item" data-lat="-6.13" data-lng="39.31" data-name="Zanzibar">
                                <i class="fas fa-umbrella-beach"></i> ğŸ–ï¸ Zanzibar <span class="location-badge">-6.13, 39.31</span>
                            </div>
                            <div class="dest-item" data-lat="-5.2" data-lng="39.8" data-name="Pemba">
                                <i class="fas fa-island"></i> ğŸï¸ Pemba <span class="location-badge">-5.2, 39.8</span>
                            </div>
                            <div class="dest-item" data-lat="-6.43" data-lng="38.9" data-name="Bagamoyo">
                                <i class="fas fa-landmark"></i> ğŸ›ï¸ Bagamoyo <span class="location-badge">-6.43, 38.9</span>
                            </div>
                            <div class="dest-item" data-lat="-8.91" data-lng="39.52" data-name="Kilwa">
                                <i class="fas fa-archaeological"></i> ğŸ—¿ Kilwa <span class="location-badge">-8.91, 39.52</span>
                            </div>
                            <div class="dest-item" data-lat="-5.43" data-lng="38.85" data-name="Pangani">
                                <i class="fas fa-umbrella-beach"></i> ğŸŒ´ Pangani <span class="location-badge">-5.43, 38.85</span>
                            </div>
                            <div class="dest-item" data-lat="-3.5" data-lng="35.8" data-name="Manyara">
                                <i class="fas fa-dove"></i> ğŸ¦¢ Lake Manyara <span class="location-badge">-3.5, 35.8</span>
                            </div>
                            <div class="dest-item" data-lat="-4.0" data-lng="36.8" data-name="Tarangire">
                                <i class="fas fa-tree"></i> ğŸŒ´ Tarangire <span class="location-badge">-4.0, 36.8</span>
                            </div>
                            <div class="dest-item" data-lat="-7.95" data-lng="37.45" data-name="Selous">
                                <i class="fas fa-water"></i> ğŸŠ Selous <span class="location-badge">-7.95, 37.45</span>
                            </div>
                            <div class="dest-item" data-lat="-3.07" data-lng="37.35" data-name="Kilimanjaro">
                                <i class="fas fa-mountain"></i> ğŸ§— Kilimanjaro <span class="location-badge">-3.07, 37.35</span>
                            </div>
                        </div>
                        <div style="margin-top:32px; background:#eaf9f5; padding:24px; border-radius:28px;">
                            <span style="font-weight:800;"><i class="fas fa-info-circle"></i> âœ¨ emerging destinations:</span> Turkana (3.12,35.6), Shaba (0.65,37.6), Kilwa (-8.91,39.52), Pangani (-5.43,38.85), Matthews (1.9,37.2)
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== FOOTER ========= -->
            <div class="footer">
                <i class="fas fa-bolt"></i> STAPâ€‘Kenya Â· East Africa edition Â· 30+ tourist sites with precise GPS coordinates
                <div style="margin-top: 18px;">ğŸ“ every destination mapped Â· live congestion Â· AI predictive Â· offline first</div>
            </div>
        </div>
    </div>

    <script>
        // ------------------------------------------------------------
        // USER AUTHENTICATION SYSTEM (localStorage based)
        // ------------------------------------------------------------
        
        // In-memory user store (persisted in localStorage)
        let users = JSON.parse(localStorage.getItem('stap_users')) || [];
        let currentUser = JSON.parse(localStorage.getItem('stap_current_user')) || null;

        // Tab switching between login and signup
        window.showLogin = function() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('loginTabBtn').classList.add('active');
            document.getElementById('signupTabBtn').classList.remove('active');
        };

        window.showSignup = function() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.remove('hidden');
            document.getElementById('loginTabBtn').classList.remove('active');
            document.getElementById('signupTabBtn').classList.add('active');
        };

        // Signup handler
        window.handleSignup = function() {
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !password) {
                alert('Please fill in all fields');
                return;
            }
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            if (users.find(u => u.email === email)) {
                alert('Email already registered. Please login.');
                return;
            }

            const newUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                password: password
            };
            users.push(newUser);
            localStorage.setItem('stap_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('stap_current_user', JSON.stringify(newUser));
            
            showApp();
        };

        // Login handler
        window.handleLogin = function() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }

            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                localStorage.setItem('stap_current_user', JSON.stringify(user));
                showApp();
            } else {
                alert('Invalid email or password');
            }
        };

        // Logout function
        window.logout = function() {
            currentUser = null;
            localStorage.removeItem('stap_current_user');
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('signupName').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
        };

        // Show main app and set greeting with user's name
        function showApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            if (currentUser) {
                const now = new Date();
                const hour = now.getHours();
                let greeting = '';
                let emoji = '';
                
                if (hour < 12) {
                    greeting = 'Good morning';
                    emoji = 'â˜€ï¸ğŸ‘ğŸ˜Š';
                } else if (hour < 18) {
                    greeting = 'Good afternoon';
                    emoji = 'ğŸŒğŸ‘ğŸ˜';
                } else {
                    greeting = 'Good evening';
                    emoji = 'ğŸŒ™ğŸ‘ğŸ˜Œ';
                }
                
                const firstName = currentUser.name.split(' ')[0];
                const greetingEl = document.getElementById('greetingMessage');
                if (greetingEl) {
                    greetingEl.innerHTML = `${greeting}, ${firstName}! <span>ğŸ‘‹âœ¨</span>`;
                }
                document.getElementById('greetingEmoji').innerHTML = emoji;
            }
            
            initializeApp();
            addLogoutButton();
        }

        // Add logout button to header
        function addLogoutButton() {
            const header = document.querySelector('.header');
            if (header && !document.getElementById('logoutBtn')) {
                const logoutBtn = document.createElement('button');
                logoutBtn.id = 'logoutBtn';
                logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                logoutBtn.style.background = 'rgba(255,255,255,0.2)';
                logoutBtn.style.border = '2px solid white';
                logoutBtn.style.color = 'white';
                logoutBtn.style.padding = '12px 24px';
                logoutBtn.style.borderRadius = '60px';
                logoutBtn.style.fontWeight = '600';
                logoutBtn.style.cursor = 'pointer';
                logoutBtn.style.marginLeft = '20px';
                logoutBtn.style.transition = '0.2s';
                logoutBtn.onmouseover = function() { this.style.background = 'rgba(255,255,255,0.3)'; };
                logoutBtn.onmouseout = function() { this.style.background = 'rgba(255,255,255,0.2)'; };
                logoutBtn.onclick = window.logout;
                header.appendChild(logoutBtn);
            }
        }

        // ------------------------------------------------------------
        // COMPREHENSIVE DESTINATION COORDINATES DATABASE
        // ------------------------------------------------------------
        const destinationCoordinates = {
            // KENYA (19)
            mara: [-1.406, 35.0],
            amboseli: [-2.638, 37.262],
            tsavo: [-3.347, 38.136],
            samburu: [0.6, 37.5],
            meru: [0.1, 38.2],
            shaba: [0.65, 37.6],
            nakuru: [-0.3, 36.1],
            naivasha: [-0.7, 36.4],
            aberdare: [-0.4, 36.7],
            mtkenya: [0.1, 37.3],
            kakamega: [0.28, 34.75],
            watamu: [-3.35, 40.02],
            lamu: [-2.27, 40.9],
            kisumu: [-0.09, 34.75],
            turkana: [3.12, 35.6],
            matthews: [1.9, 37.2],
            lewa: [0.2, 37.1],
            arabuko: [-3.3, 39.95],
            giraffe: [-1.33, 36.78],
            // TANZANIA / ZANZIBAR (11)
            ngorongoro: [-3.2, 35.5],
            serengeti: [-2.3, 34.8],
            zanzibar: [-6.13, 39.31],
            pemba: [-5.2, 39.8],
            bagamoyo: [-6.43, 38.9],
            kilwa: [-8.91, 39.52],
            pangani: [-5.43, 38.85],
            manyara: [-3.5, 35.8],
            tarangire: [-4.0, 36.8],
            selous: [-7.95, 37.45],
            kilimanjaro: [-3.07, 37.35]
        };

        const gateNames = { 
            mara:'Maasai Mara', amboseli:'Amboseli', tsavo:'Tsavo', samburu:'Samburu', meru:'Meru', shaba:'Shaba',
            nakuru:'Lake Nakuru', naivasha:'Naivasha', aberdare:'Aberdare', mtkenya:'Mt Kenya', kakamega:'Kakamega',
            watamu:'Watamu', lamu:'Lamu', kisumu:'Kisumu', turkana:'Turkana', matthews:'Matthews', lewa:'Lewa',
            arabuko:'Arabuko-Sokoke', giraffe:'Giraffe Centre',
            ngorongoro:'Ngorongoro', serengeti:'Serengeti', zanzibar:'Zanzibar', pemba:'Pemba', bagamoyo:'Bagamoyo',
            kilwa:'Kilwa', pangani:'Pangani', manyara:'Manyara', tarangire:'Tarangire', selous:'Selous', kilimanjaro:'Kilimanjaro'
        };

        // ------------------------------------------------------------
        // STAP-KENYA APP LOGIC
        // ------------------------------------------------------------
        function initializeApp() {
            // ---------- GLOBAL STATE ----------
            window.STAP = {
                congestionBase: { 
                    mara: 68, amboseli: 52, tsavo: 44, samburu: 38, meru: 26, shaba: 24, nakuru: 58, naivasha: 52, aberdare: 40, mtkenya: 34, kakamega: 22, watamu: 59, lamu: 30, kisumu: 41, turkana: 24, matthews: 17, lewa: 33, arabuko: 29, giraffe: 48,
                    ngorongoro: 58, serengeti: 64, zanzibar: 44, pemba: 28, bagamoyo: 26, kilwa: 20, pangani: 22, manyara: 50, tarangire: 43, selous: 23, kilimanjaro: 37
                },
                currentGate: 'mara',
                diversionLevel: 32,
                ecoScore: 91,
                communityCount: 92,
                mpesaVolume: 284.6,
                bookings: 178,
                credits: 2680,
                turkana: 188,
                lamu: 172,
                zanzibar: 218,
                mara: 204,
                edgeNodes: 26,
                syncQueue: 11,
                cacheRecs: 792,
                activePrefs: ['wildlife','cultural']
            };

            // ---------- HEADER UPDATES ----------
            function updateHeaders() {
                document.getElementById('headerCongestion').innerText = `-${STAP.diversionLevel}%`;
                document.getElementById('headerEco').innerText = STAP.ecoScore;
                document.getElementById('headerCommunity').innerText = `+${Math.floor(58 + Math.random()*12)}%`;
            }

            // ---------- TAB 1 :: AI ITINERARY ----------
            const prefTags = document.querySelectorAll('#prefTags .tag');
            const prefSummary = document.getElementById('prefSummary');
            const itineraryOutput = document.getElementById('itineraryOutput');
            const generateBtn = document.getElementById('generateBtn');
            const randomPrefBtn = document.getElementById('randomPrefBtn');
            const resetPrefBtn = document.getElementById('resetPrefBtn');

            function updatePrefSummary() {
                let active = Array.from(prefTags).filter(t => t.classList.contains('active'));
                let text = active.map(t => t.innerText.trim().replace(/[^\w\sğŸ¦ğŸ•ï¸ğŸ§—ğŸ–ï¸ğŸ¦©ğŸ›ï¸ğŸ¥¾]/g,'')).join(' Â· ');
                prefSummary.innerText = text || 'none';
                STAP.activePrefs = active.map(t => t.dataset.pref);
            }

            function generateItinerary() {
                let prefs = STAP.activePrefs || ['wildlife','cultural'];
                let dest, alt, eco, note;
                
                if (prefs.includes('beach') && !prefs.includes('wildlife')) {
                    let beachOpts = ['Zanzibar', 'Watamu', 'Lamu', 'Pemba', 'Pangani'];
                    dest = beachOpts[Math.floor(Math.random() * beachOpts.length)];
                    alt = dest === 'Zanzibar' ? 'Pemba' : (dest === 'Watamu' ? 'Kilwa' : 'Bagamoyo');
                    eco = 78 + Math.floor(Math.random()*8);
                    note = `ğŸŒŠ ${dest}: pristine beaches, coral reefs. ${alt} offers -34% visitors. ğŸ–ï¸ğŸ `;
                } else if (prefs.includes('birding')) {
                    let birdOpts = ['Lake Nakuru', 'Lake Manyara', 'Kisumu', 'Lake Naivasha'];
                    dest = birdOpts[Math.floor(Math.random() * birdOpts.length)];
                    alt = dest === 'Lake Nakuru' ? 'Lake Baringo' : 'Amboseli wetlands';
                    eco = 86 + Math.floor(Math.random()*7);
                    note = `ğŸ¦© ${dest}: flamingos, pelicans. ${alt} excellent birding. ğŸ¦âœ¨`;
                } else if (prefs.includes('adventure') || prefs.includes('hiking')) {
                    let advOpts = ['Mount Kenya', 'Matthews Range', 'Hell\'s Gate', 'Ngorongoro', 'Tsavo', 'Kilimanjaro'];
                    dest = advOpts[Math.floor(Math.random() * advOpts.length)];
                    alt = dest === 'Mount Kenya' ? 'Aberdare' : 'Mt. Longonot';
                    eco = 82 + Math.floor(Math.random()*7);
                    note = `ğŸ¥¾ ${dest}: hiking, wildlife. ${alt} 40% fewer visitors. ğŸ”ï¸`;
                } else if (prefs.includes('historical')) {
                    let histOpts = ['Lamu', 'Zanzibar Stone Town', 'Kilwa', 'Bagamoyo', 'Gedi Ruins'];
                    dest = histOpts[Math.floor(Math.random() * histOpts.length)];
                    alt = dest === 'Lamu' ? 'Mombasa Old Town' : 'Pangani';
                    eco = 90 + Math.floor(Math.random()*6);
                    note = `ğŸ›ï¸ ${dest}: UNESCO heritage, Swahili culture. ${alt} authentic. ğŸ•Œ`;
                } else if (prefs.includes('cultural')) {
                    let cultOpts = ['Maasai Mara', 'Samburu', 'Turkana', 'Hadzabe', 'Lewa'];
                    dest = cultOpts[Math.floor(Math.random() * cultOpts.length)];
                    alt = dest === 'Maasai Mara' ? 'Taita Taveta' : 'Il Ngwesi';
                    eco = 89 + Math.floor(Math.random()*7);
                    note = `ğŸ•ï¸ direct community benefit. EcoScore ${eco}. ğŸ¤`;
                } else {
                    let safariOpts = ['Maasai Mara', 'Amboseli', 'Serengeti', 'Ngorongoro', 'Tsavo'];
                    dest = safariOpts[Math.floor(Math.random() * safariOpts.length)];
                    alt = dest === 'Maasai Mara' ? 'Selenkay' : (dest === 'Amboseli' ? 'Chyulu Hills' : 'Lake Manyara');
                    eco = 84 + Math.floor(Math.random()*8);
                    note = `âš ï¸ ${dest} ${STAP.congestionBase[STAP.currentGate] || 60}% capacity Â· ${alt} -28% crowds. ğŸ¦`;
                }

                let html = `<div class="itinerary-card">
                    <div style="display:flex; justify-content:space-between;">
                        <div><span style="font-weight:800;font-size:22px;">ğŸ“ ${dest} Â· 3 days</span><br>
                        <span style="color:#116466; font-size:18px;"><i class="fas fa-map-pin"></i> alternative: ${alt}</span></div>
                        <span class="eco-score" style="font-size:18px;"><i class="fas fa-leaf"></i> ${eco}</span>
                    </div>
                    <div style="margin-top:18px; display:flex; gap:28px; font-size:17px;">
                        <span><i class="fas fa-user-friends"></i> 2 adults ğŸ‘¥</span>
                        <span><i class="fas fa-calendar"></i> ${new Date().toLocaleDateString('en-GB', { day:'numeric', month:'short' })} trip ğŸ“…</span>
                    </div>
                    <div style="background:#eaf9f5; margin-top:20px; padding:18px; border-radius:20px; font-size:17px;">
                        <i class="fas fa-lightbulb" style="color:#e09b2e;"></i> ğŸ’¡ ${note}
                    </div>
                </div>`;
                itineraryOutput.innerHTML = html;
                STAP.ecoScore = eco;
                if(document.getElementById('ecoScoreTab4')) document.getElementById('ecoScoreTab4').innerText = eco;
                updateHeaders();
            }

            prefTags.forEach(t => {
                t.removeEventListener('click', handlePrefClick);
                t.addEventListener('click', handlePrefClick);
            });
            function handlePrefClick() {
                this.classList.toggle('active');
                updatePrefSummary();
                generateItinerary();
            }

            generateBtn.removeEventListener('click', generateItinerary);
            generateBtn.addEventListener('click', generateItinerary);
            
            randomPrefBtn.removeEventListener('click', randomPrefHandler);
            randomPrefBtn.addEventListener('click', randomPrefHandler);
            function randomPrefHandler() {
                prefTags.forEach(t => t.classList.remove('active'));
                let picks = ['wildlife','cultural','adventure','beach','birding','historical','hiking'];
                let rand = picks[Math.floor(Math.random()*picks.length)];
                document.querySelector(`[data-pref="${rand}"]`)?.classList.add('active');
                if (Math.random()>0.4) document.querySelector('[data-pref="cultural"]')?.classList.add('active');
                updatePrefSummary();
                generateItinerary();
            }

            resetPrefBtn.removeEventListener('click', resetPrefHandler);
            resetPrefBtn.addEventListener('click', resetPrefHandler);
            function resetPrefHandler() {
                prefTags.forEach(t => t.classList.remove('active'));
                document.querySelector('[data-pref="wildlife"]')?.classList.add('active');
                document.querySelector('[data-pref="cultural"]')?.classList.add('active');
                updatePrefSummary();
                generateItinerary();
            }

            // ---------- TAB 2 :: PREDICTIVE MAP ----------
            function refreshTab2UI() {
                let base = STAP.congestionBase[STAP.currentGate] || 60;
                let reduction = (STAP.diversionLevel / 100) * base * 0.9;
                let effective = Math.max(25, Math.min(98, base - reduction));
                effective = Math.round(effective);
                let fillEl = document.getElementById('congestionFillTab2');
                if(fillEl) fillEl.style.width = effective + '%';
                let liveEl = document.getElementById('liveCongestionPercentTab2');
                if(liveEl) liveEl.innerText = effective + '%';
                let txtEl = document.getElementById('congestionTextTab2');
                if(txtEl) txtEl.innerText = effective + '% capacity';
                let nameEl = document.getElementById('gateNameDisplayTab2');
                if(nameEl) nameEl.innerText = gateNames[STAP.currentGate] || 'Maasai Mara';
                let divVal = document.getElementById('diversionValueTab2');
                if(divVal) divVal.innerText = `-${STAP.diversionLevel}% congestion`;
                let diverted = Math.round(STAP.diversionLevel * 14.2);
                let alertEl = document.getElementById('alertMessageTab2');
                if(alertEl) alertEl.innerHTML = `<i class="fas fa-bolt"></i> LSTM forecast: ${diverted} vehicles diverted Â· ${effective}% capacity ğŸš—ğŸ’¨`;
                let coordsEl = document.getElementById('markerCoords');
                if (coordsEl && destinationCoordinates[STAP.currentGate]) {
                    coordsEl.innerText = `${destinationCoordinates[STAP.currentGate][0].toFixed(3)}, ${destinationCoordinates[STAP.currentGate][1].toFixed(3)}`;
                }
            }
            
            // Gate selector
            const gateSelector = document.getElementById('gateSelectorTab2');
            if (gateSelector) {
                gateSelector.removeEventListener('change', gateChangeHandler);
                gateSelector.addEventListener('change', gateChangeHandler);
            }
            function gateChangeHandler(e) {
                STAP.currentGate = e.target.value;
                refreshTab2UI();
                updateMapMarker(STAP.currentGate);
            }

            const diversionSlider = document.getElementById('diversionSliderTab2');
            if (diversionSlider) {
                diversionSlider.removeEventListener('input', diversionHandler);
                diversionSlider.addEventListener('input', diversionHandler);
            }
            function diversionHandler(e) {
                STAP.diversionLevel = parseInt(e.target.value);
                refreshTab2UI();
                updateHeaders();
            }

            // Map for Tab 2
            let mapTab2 = L.map('mapTab2').setView([-1.286, 36.817], 5);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(mapTab2);
            let markerTab2;
            function updateMapMarker(gate) {
                if (markerTab2) mapTab2.removeLayer(markerTab2);
                let coord = destinationCoordinates[gate] || [-1.286,36.817];
                markerTab2 = L.marker(coord).addTo(mapTab2).bindPopup(gateNames[gate] || 'Gate').openPopup();
            }
            updateMapMarker('mara');

            // Peak and success buttons
            const peakBtn = document.getElementById('peakBtnTab2');
            if (peakBtn) {
                peakBtn.removeEventListener('click', peakHandler);
                peakBtn.addEventListener('click', peakHandler);
            }
            function peakHandler() {
                STAP.congestionBase.mara = 94; STAP.congestionBase.amboseli = 82; STAP.congestionBase.ngorongoro = 88; STAP.congestionBase.zanzibar = 76;
                refreshTab2UI();
            }

            const successBtn = document.getElementById('aiSuccessBtnTab2');
            if (successBtn) {
                successBtn.removeEventListener('click', successHandler);
                successBtn.addEventListener('click', successHandler);
            }
            function successHandler() {
                STAP.congestionBase.mara = 58; STAP.congestionBase.amboseli = 44; STAP.congestionBase.ngorongoro = 48; STAP.congestionBase.zanzibar = 38;
                STAP.diversionLevel = 32; 
                let slider = document.getElementById('diversionSliderTab2');
                if(slider) slider.value = 32; 
                refreshTab2UI();
                updateHeaders();
            }

            // ---------- TAB 6 :: ALL DESTINATIONS MAP ----------
            let mapAll = L.map('mapAllDestinations').setView([-2.5, 36.5], 5.5);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(mapAll);
            
            // Add markers for all 30 destinations
            const markers = {};
            Object.keys(destinationCoordinates).forEach(key => {
                const coord = destinationCoordinates[key];
                const name = gateNames[key] || key;
                const marker = L.marker(coord).addTo(mapAll).bindPopup(`
                    <b>${name}</b><br>
                    ğŸ“ ${coord[0].toFixed(3)}, ${coord[1].toFixed(3)}<br>
                    ${key.includes('mara') || key.includes('amboseli') || key.includes('ngorongoro') ? 'ğŸ”¥ Crowded' : 'ğŸŒ¿ Recommended'}
                `);
                markers[key] = marker;
            });

            // Click handlers for destination items
            document.querySelectorAll('.dest-item').forEach(el => {
                el.addEventListener('click', function() {
                    const lat = parseFloat(this.dataset.lat);
                    const lng = parseFloat(this.dataset.lng);
                    const name = this.dataset.name;
                    mapAll.setView([lat, lng], 8);
                    L.popup()
                        .setLatLng([lat, lng])
                        .setContent(`<b>${name}</b><br>ğŸ“ ${lat.toFixed(3)}, ${lng.toFixed(3)}`)
                        .openOn(mapAll);
                });
            });

            // ---------- TAB 3 MARKETPLACE ----------
            function refreshTab3UI() {
                if(document.getElementById('communityCountTab3')) document.getElementById('communityCountTab3').innerText = STAP.communityCount;
                if(document.getElementById('turkanaBookingsTab3')) document.getElementById('turkanaBookingsTab3').innerText = `+${STAP.turkana}%`;
                if(document.getElementById('lamuBookings')) document.getElementById('lamuBookings').innerText = `+${STAP.lamu}%`;
                if(document.getElementById('zanzibarBookings')) document.getElementById('zanzibarBookings').innerText = `+${STAP.zanzibar}%`;
                if(document.getElementById('maraBookings')) document.getElementById('maraBookings').innerText = `+${STAP.mara}%`;
                if(document.getElementById('mpesaVolumeTab3')) document.getElementById('mpesaVolumeTab3').innerText = `KES ${STAP.mpesaVolume.toFixed(1)}K`;
                if(document.getElementById('bookingCountTab3')) document.getElementById('bookingCountTab3').innerText = STAP.bookings;
                if(document.getElementById('creditMintedTab3')) document.getElementById('creditMintedTab3').innerText = STAP.credits;
            }

            document.getElementById('boostTurkanaBtn')?.addEventListener('click', function(){ STAP.turkana += 12; refreshTab3UI(); });
            document.getElementById('boostLamuBtn')?.addEventListener('click', function(){ STAP.lamu += 15; refreshTab3UI(); });
            document.getElementById('boostZanzibarBtn')?.addEventListener('click', function(){ STAP.zanzibar += 18; refreshTab3UI(); });
            document.getElementById('boostMaraBtn')?.addEventListener('click', function(){ STAP.mara += 14; refreshTab3UI(); });
            document.getElementById('simulateBookingBtn')?.addEventListener('click', function(){ STAP.mpesaVolume += (Math.random()*8+5); STAP.bookings += 1; refreshTab3UI(); });
            document.getElementById('mintCreditBtn')?.addEventListener('click', function(){ STAP.credits += 5; refreshTab3UI(); });

            // ---------- TAB 4 SUSTAINABILITY ----------
            function refreshTab4UI() {
                if(document.getElementById('ecoScoreTab4')) document.getElementById('ecoScoreTab4').innerText = STAP.ecoScore;
                let badge = document.getElementById('ecoBadgeTab4');
                if(badge) badge.innerHTML = STAP.ecoScore >=85 ? 'ğŸŒ¿ gold' : (STAP.ecoScore>=70 ? 'ğŸƒ silver' : 'ğŸŒ± bronze');
                if(document.getElementById('carbonTab4')) document.getElementById('carbonTab4').innerText = Math.floor(100 - STAP.diversionLevel/2) + ' kg';
                if(document.getElementById('waterTab4')) document.getElementById('waterTab4').innerText = Math.floor(260 - STAP.diversionLevel) + ' L';
                if(document.getElementById('wasteTab4')) document.getElementById('wasteTab4').innerText = (2.1 - STAP.diversionLevel/100).toFixed(1) + ' kg';
                if(document.getElementById('bioTab4')) document.getElementById('bioTab4').innerText = 80 + Math.floor(STAP.ecoScore/10);
            }
            document.getElementById('optimizeGreenBtnTab4')?.addEventListener('click', function(){
                STAP.ecoScore = Math.min(98, STAP.ecoScore + 6);
                refreshTab4UI();
                updateHeaders();
            });

            const ctx = document.getElementById('ecoChart')?.getContext('2d');
            if (ctx) {
                if (window.ecoChartInstance) window.ecoChartInstance.destroy();
                window.ecoChartInstance = new Chart(ctx, { 
                    type: 'doughnut', 
                    data: { 
                        labels: ['transport','accommodation','dining','activities'], 
                        datasets: [{ 
                            data: [34,28,22,16], 
                            backgroundColor: ['#2a9d8f','#70b3a3','#a8d5ca','#cfece8'] 
                        }] 
                    },
                    options: { cutout: '70%', plugins: { legend: { display: false } } }
                });
            }

            // ---------- TAB 5 OFFLINE ----------
            function refreshTab5UI() {
                if(document.getElementById('cacheCountTab5')) document.getElementById('cacheCountTab5').innerText = STAP.cacheRecs;
                if(document.getElementById('edgeNodesTab5')) document.getElementById('edgeNodesTab5').innerText = STAP.edgeNodes;
                if(document.getElementById('syncQueueTab5')) document.getElementById('syncQueueTab5').innerText = STAP.syncQueue;
            }
            document.getElementById('simulateOfflineBtn')?.addEventListener('click', function(){ STAP.syncQueue += 7; refreshTab5UI(); });
            document.getElementById('deployNodeBtn')?.addEventListener('click', function(){ STAP.edgeNodes += 1; refreshTab5UI(); });

            // ---------- TAB SWITCHING ----------
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => {
                t.removeEventListener('click', tabClickHandler);
                t.addEventListener('click', tabClickHandler);
            });
            
            function tabClickHandler() {
                tabs.forEach(tab => tab.classList.remove('active'));
                this.classList.add('active');
                contents.forEach(c => c.classList.add('hidden'));
                const targetId = this.dataset.tab;
                const targetEl = document.getElementById(targetId);
                if (targetEl) targetEl.classList.remove('hidden');
                
                // Refresh map when switching to tab 6
                if (targetId === 'tab6') {
                    setTimeout(() => mapAll.invalidateSize(), 100);
                }
                if (targetId === 'tab2') {
                    setTimeout(() => mapTab2.invalidateSize(), 100);
                }
            }

            // Initial UI updates
            updatePrefSummary();
            generateItinerary();
            refreshTab2UI();
            refreshTab3UI();
            refreshTab4UI();
            refreshTab5UI();
            updateHeaders();

            // Leaflet icons fix
            delete L.Icon.Default.prototype._getIconUrl;
            L.Icon.Default.mergeOptions({ 
                iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',
                iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png' 
            });
        }

        // Auto-login if user already logged in
        if (currentUser) {
            showApp();
        }
    </script>
</body>
</html>